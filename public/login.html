<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Enenrgy Trading Market</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <script src="https://cdn.socket.io/socket.io-4.0.1.min.js"></script>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script src="../dev/server.js" defer></script>

    
  </head>
  <body>
    <style>
      .navbar {
       background-color: #222;
       transition: background-color 0.5s ease;
     }
     
     .navbar-brand {
       font-size: 2rem;
       font-weight: bold;
       animation: pulse 2s infinite; 
     }
     
     
     
     .nav-link {
       font-size: 1.2rem;
       margin-left: 1rem;
       transition: transform 0.2s ease;
     }
     
     .nav-link:hover {
       transform: scale(1.2);
     }
     
     @media (max-width: 768px) {
       .navbar-brand {
         font-size: 1.5rem;
       }
     
       .nav-link {
         font-size: 1rem;
         margin-left: 0.5rem;
       }
       .energy-balance {
         position: absolute;
         bottom: 10px;
         right: 10px;
         font-size: 14px;
         color: white;
     }
     
     }
     
     .registration-link  {
    display: inline-block;
    padding: 10px 30px;
    background-color: #e9ecef;
    color: #191a18;
    text-decoration: none;
    border-radius: 30px;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 16px;
   }
  
  
  .registration-link:hover {
    background-color: #212529;
    color: #fff;
  }
  #sub {
    display: inline-block;
    padding: 10px 30px;
    background-color: #e9ecef;
    color: #292821;
    text-decoration: none;
    border-radius: 30px;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 16px;
    
  }
  #sub:hover {
    background-color: #0e78e2;
    color: #fff;
  }
  </style>
         <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
             <div class="container-fluid">
               
               <a class="navbar-brand" href="#">
                 <img src="../images/blockchain_log.png" alt="logo" width="50" height="34">
               </a>    
               <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                 <span class="navbar-toggler-icon"></span>
               </button>
               <div class="collapse navbar-collapse" id="navbarSupportedContent">
                 <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                   <li class="nav-item">
                     <a class="nav-link active" id="home" aria-current="page" href="./Marketplace.html">Home</a>
                   </li>
                   <li class="nav-item">
                     <a class="nav-link active" id="info"  href="#">Info</a>
                      
                   </li>
                   <li class="nav-item dropdown">
                     <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                       Wallets
                     </a>
                     <ul class="dropdown-menu">
                      
                       
                       <li><a class="dropdown-item" id = "energy-wallet" href="#">Energy Wallet</a></li>
                       <li><a class="dropdown-item" id = "eth-wallet" href="#">Eth wallet</a></li>
                     </ul>
                   </li>
                   <li class="nav-item">
                     <a class="nav-link active ">Contact us</a>
                   </li>
                 </ul>
                 <form class="d-flex" role="search">
                   <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                   <button class="btn btn-outline-success" type="submit">Search</button>
                 </form>
               </div>
             </div> 
           </nav> 
    
           <div class="container">
            <div class="row">
              <div class="col-md-6 offset-md-3 mt-5">
                <h2 class="text-center mb-4">Energy Trading Platform</h2>
                <div class="card shadow">
                  <div class="card-body">
                    <form id="myForm" action="../public/Marketplace.html" method="GET">
                      <div class="form-group">
                        <label for="account">Account Address</label>
                        <input type="Address" class="form-control" id="account" name="Account" required>
                      </div>
                      <div class="form-group">
                        <label for="privatekey">Private Key</label>
                        <input type="password" class="form-control" id="privatekey" name="PrivateKey" required>
                      </div>
                      <div class="form-group text-center">
                        <button type="submit" class="btn btn-primary btn-lg rounded-pill" id="sub">Login</button>
                      </div>
                    </form>
                    <div class="text-center mt-3">
                      <a href="../public/registration.html" class="registration-link">Sign up now</a>
                    </div>
                    
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.min.js" integrity="sha384-heAjqF+bCxXpCWLa6Zhcp4fu20XoNIA98ecBC1YkdXhszjoejr5y9Q77hIrv8R9i" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+J9B0BkNE10H0jt2imIv1j6KwBQY.." crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        
     <script>
    
      const submitButton = document.querySelector('#sub');
      const form = document.getElementById('myForm');
      var flag = 0;
      const socket = io('http://localhost:3000');
     
    
      submitButton.addEventListener('click', async (event) => {
        event.preventDefault();
        const account = document.querySelector('#account').value;
        const key = document.querySelector('#privatekey').value;
       
        socket.emit('login', { account, key });
        socket.on('error-log', (error) => {
          alert(error.message);
          location.reload(); // Reload the page on error 

        });
        socket.on('error', (error) => {
          alert(error); 
          location.reload(); // Reload the page on error
        });
       
        socket.on('loginSuccessful', (response) => {
          // console.log(response)
          if (response) {
            // Perform the action of form
            document.getElementById("myForm").submit();
          } 
        });

       
      });
      const links = document.querySelectorAll('#pricing-link, #info, #eth-wallet, #energy-wallet,#home');
            
      links.forEach(link => {
        link.addEventListener('click', event => {
          event.preventDefault();

          // Emit a "checkLoggedIn" event to the server
          socket.emit('checkLoggedIn', (isLoggedIn) => {
            // If user is not logged in, show warning and prevent navigation
            if (!isLoggedIn) {
              alert('You need to log in to access this page!');
              return;
            }

            // If user is logged in, navigate to the link's href
            window.location.href = link.href;
          });
        });
      });

     

      // const links = document.querySelectorAll('#pricing-link, #info , #eth-wallet,#energy-wallet');
      //   links.forEach(link => {
      //           link.addEventListener('click', event => {
      //           event.preventDefault();

      //           // Check if user is logged in
      //           const isLoggedIn = checkIfUserIsLoggedIn();

      //           // If user is not logged in, show warning and prevent navigation
      //           if (!isLoggedIn) {
      //             alert('You need to log in to access this page!');
      //             return;
      //           }

      //           // If user is logged in, navigate to the link's href
      //           window.location.href = link.href;
      //         });
      //       });

      //   function checkIfUserIsLoggedIn() {
         
      //     return false;
      //   }

        


//   const verifyResponse = await fetch('http://localhost:3000/verify', {
  //     method: 'POST',
  //     headers: {
  //       'Content-Type': 'application/json'
  //     },
  //     body: JSON.stringify({
  //       account,
  //       key
  //     })
  //   });

  //   // const verifyResult = await verifyResponse.json();
  //   if (verifyResponse.status === 200) {
  //     // i want to perform the action of form 
  //     document.getElementById("myForm").submit();
  //   } else {
  //     const errorMessage = await verifyResponse.json();
  //     console.log(errorMessage);
  //     // Display error message to user here
  //   }


    </script>
  </body>
</html>



